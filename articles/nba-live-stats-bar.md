---
title: "MacのメニューバーにNBAの試合経過を表示する (Python + SwiftBar)"
emoji: "🏀"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["python", "uv", "swiftbar", "nba", "mac"]
published: false
---

:::message
この記事は [Mavs Advent Calendar 2025](https://adventar.org/calendars/11595) の 9日目の記事です。🎅
:::

# はじめに

Macのメニューバーは、システムの状態や通知を確認するための重要な領域です。
しかし、既存のアプリだけでは「自分だけの特定の情報」を、「好みの形式」で表示することは容易ではありません。

例えば、私はNBAの試合経過をリアルタイムで確認したいと考えていました。ブラウザを常時開いておくのは作業の妨げになりますし、既存の通知アプリでは情報の粒度や表示形式が自分のニーズに合致しませんでした。

そこで、**SwiftBar** と **Python** を組み合わせることで、スクリプトの実行結果をメニューバーに柔軟に表示する環境を構築しました。

今回は作成した「NBA Live Stats Bar」を実例として、**Pythonスクリプトを、あたかも単体のメニューバーアプリのように手軽に扱う方法**を紹介します。

## NBAの試合経過を表示するメニューバーを作った

まずは、この仕組みを使って何ができるのか、実際の成果物をご覧ください。
Macのメニューバーに、現在行われているNBAの試合スコアをリアルタイムに表示するプラグインです。

https://github.com/p-t-a-p-1/nba-live-stats-bar

![進行中の試合がない場合は結果が表示されます](/images/nba-live-stats-bar/demo1.png)
*進行中の試合がない場合は結果が表示されます*

*メニューバーに `🏀 LAL 110-108 GSW (Q4 2:00)` のように表示されます*

クリックするとドロップダウンで以下の情報が表示されます。
- 当日の全試合のスコアとステータス
- 進行中の試合の直近のPlay-by-Play（得点経過など）
- 試合開始前の予定時刻

このように、単なるテキスト表示だけでなく、ドロップダウンを用いた詳細情報の表示や、色・フォントの制御も可能です。

## 技術構成：Python × SwiftBar による柔軟な実行環境

このツールの核心は、NBAのデータを取得することそのものよりも、**「Pythonスクリプトをメニューバーで実行させる」** という点にあります。

### 構成要素

- **SwiftBar**: シェルスクリプトやプログラムの標準出力をメニューバーに表示するmacOSアプリケーション。
- **Python**: データの取得、整形、表示ロジックの記述に使用。

### Python環境の管理について (uvの活用)

通常、`nba_api` のような外部ライブラリを使用するPythonスクリプトを配布・実行する場合、受け手側での環境構築（`venv`の作成、`pip install`など）が障壁となります。

そこで、今回は環境管理ツールとして **uv** を利用しました。
uvの [PEP 723 (Inline Script Metadata)](https://peps.python.org/pep-0723/) サポートを活用することで、スクリプト内に依存関係を記述し、実行時に自動的に環境を構築させることができます。

スクリプトの冒頭に以下のようなメタデータを記述します：

```python
#!/opt/homebrew/bin/uv run
# /// script
# requires-python = ">=3.11"
# dependencies = [
#     "nba-api",
# ]
# ///
```

この記述により、スクリプト実行時に `uv` が自動的に必要なライブラリ（`nba-api`）を含む一時的な仮想環境を構築してくれます。
これにより、ユーザーは手動での `pip install` や仮想環境の管理を意識することなく、スクリプトを実行できます。

## 実装のポイント：柔軟な表示と制御

SwiftBarは標準出力の内容をパースして表示するため、Python側で出力を制御することで柔軟な表現が可能です。

### 1. 状況に応じた表示の切り替え

複数の試合が同時に行われている場合、メニューバーという限られたスペースに全ての情報を表示することはできません。
そこで、スクリプト内でロジックを組み、**「最も接戦」または「終了間際」の試合**を自動的に判定し、優先的に表示させています。

このように、単なるデータの羅列ではなく、ロジックに基づいた「今見るべき情報」のフィルタリングができるのが、スクリプト実行型の強みです。

### 2. キャッシュによる耐障害性の向上

外部API（今回は `nba_api`）を利用する場合、ネットワークエラーやAPI制限への対策が必要です。
本スクリプトでは簡易的なキャッシュ機能を実装しており、API取得に失敗した場合でも直近のデータを表示し続けることで、メニューバーから情報が消えることを防いでいます。

```python
# キャッシュロジックの簡略例
def main():
    data = get_scoreboard_data()
    
    if data is None:
        data = load_cache()
        if data is None:
            print("🏀 Error | color=red") # エラー時は赤字で通知
            return
    else:
        save_cache(data)
    # ...表示処理
```

### 3. リッチな情報の階層化

SwiftBarの仕様に合わせ、`--` プレフィックスを付けることでサブメニューを作成できます。
これを利用し、進行中の試合についてはPlay-by-Play（詳細な試合経過）を展開して確認できるようにしました。

```python
# SwiftBarのフォーマットに合わせて出力
print(f"--{time_str} {desc} | font=Monaco size=11")
```

必要な時だけ詳細にアクセスできるUIは、常駐型アプリにおいて非常に重要です。

## 導入方法

この仕組みがいかに手軽かを感じていただくため、導入手順を記載します。

1. **SwiftBar** をインストール (`brew install --cask swiftbar`)
2. **uv** をインストール (`curl -LsSf https://astral.sh/uv/install.sh | sh`)
3. リポジトリの `nba_uv.1m.py` を SwiftBar のプラグインフォルダにコピー
4. 実行権限を付与 (`chmod +x ...`)

これだけで、Pythonアプリケーションがメニューバーで動作し始めます。

## まとめ

**SwiftBar** と **Python** を組み合わせることで、豊富なライブラリ資産を活用したメニューバーツールを、手軽に作成・実行できます。

今回はNBAのスコア表示を例に挙げましたが、この構成は株価の監視、サーバーのステータス確認、天気の表示など、あらゆる用途に応用可能です。
「自分だけの情報を、自分の好きな形で常駐させる」手段として、ぜひこの構成を試してみてください。

---
GitHubリポジトリはこちら：
https://github.com/hakozaki-k/nba-live-stats-bar
